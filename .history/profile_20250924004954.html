<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ƒ∞≈ületme ‚Äì Arat</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
  :root{
    --bg:#f6f6f6; --card:#ffffff; --ink:#0b0b0b; --muted:#6b6b6b;
    --border:#e9e9e9; --shadow:0 10px 30px rgba(0,0,0,.08); --radius:16px;
    --btn:#111111; --btn-ink:#ffffff; --btn-muted:#1f1f1f;
    --ok:#0aa36b; --ok-ink:#f6fff9; --primary:#19a0b6;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.45 "Inter",system-ui,-apple-system,Segoe UI,Roboto}
  a{color:#111;text-decoration:none}
  img{display:block;max-width:100%}
  .container{max-width:1200px;margin:0 auto;padding:0 20px}

  /* === √úST NAV (birebir) === */
  .topbar{position:sticky;top:0;z-index:50;background:#0e0e0e;color:#fff;box-shadow:0 6px 24px rgba(0,0,0,.18);transition:transform .25s ease}
  .topbar.hide{transform:translateY(-120%)}
  .topline{display:flex;align-items:center;gap:16px;padding:12px 20px}
  .logo{font-weight:800;font-size:22px;color:#fff}
  .searchwrap{display:flex;align-items:center;gap:10px;flex:1}
  .chip{display:flex;align-items:center;background:#151515;border:1px solid #232323;border-radius:12px;padding:10px 12px;gap:10px;min-width:220px}
  .chip input{background:transparent;border:0;outline:0;color:#ededed;width:100%}
  .top-actions{display:flex;align-items:center;gap:14px}
  .pilllink{color:#e5e5e5;opacity:.9}
  .pillbtn{background:#151515;border:1px solid #232323;border-radius:12px;color:#fff;padding:8px 12px;font-weight:600}
  .catbar{display:flex;gap:22px;padding:10px 20px;border-top:1px solid #1d1d1d;border-bottom:1px solid #1d1d1d}
  .catbar a{color:#eaeaea;white-space:nowrap;font-weight:700;opacity:.95}

  /* Kƒ±sa nav (scroll‚Äôda g√∂r√ºnen) */
  .top-info-bar{position:fixed;top:0;left:0;right:0;transform:translateY(-120%);background:#fff;border-bottom:1px solid var(--border);box-shadow:0 10px 24px rgba(0,0,0,.07);transition:transform .25s ease;z-index:60}
  .top-info-bar.show{transform:translateY(0)}
  .ti-inner{max-width:1200px;margin:0 auto;padding:10px 20px;display:flex;align-items:center;justify-content:space-between}
  .ti-left{display:flex;align-items:center;gap:12px}
  .ti-logo{width:40px;height:40px;object-fit:cover;border-radius:10px}
  .ti-title{font-weight:700}
  .ti-sub{font-size:13px;color:var(--muted)}
  .ti-book{background:var(--btn);color:var(--btn-ink);border-radius:10px;padding:10px 14px;font-weight:700}
  .ti-book:hover{background:var(--btn-muted)}

  /* Layout */
  .detail-wrap{max-width:1200px;margin:22px auto;display:grid;grid-template-columns:2fr 1fr;gap:20px;padding:0 20px}
  @media (max-width:980px){.detail-wrap{grid-template-columns:1fr}}
  .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow)}

  /* Galeri */
  .gallery-card{overflow:hidden}
  .gallery{position:relative;border-radius:var(--radius);overflow:hidden}
  .gallery img{width:100%;height:520px;object-fit:cover}
  .next{position:absolute;right:16px;top:50%;transform:translateY(-50%);width:44px;height:44px;border-radius:50%;background:#fff;display:grid;place-items:center;box-shadow:0 8px 18px rgba(0,0,0,.2);cursor:pointer;font-size:18px}
  .dotbar{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:8px}
  .dot{width:8px;height:8px;border-radius:50%;background:#c9c9c9;opacity:.9}
  .dot.active{background:#fff}

  /* Ba≈ülƒ±k/adres */
  .biz-header{padding:18px 6px}
  .biz-header h1{margin:0 0 6px 0;font-size:28px}
  .small{color:var(--muted);font-size:14px}

  /* B√∂l√ºmler */
  .section{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;margin:14px 0}
  .section h2{margin:0 0 14px 0;font-size:22px}

  /* Hizmet satƒ±rƒ± */
  .service-row{display:grid;grid-template-columns:1fr auto auto;gap:16px;align-items:center;padding:14px;border:1px solid var(--border);border-radius:12px;margin-bottom:12px}
  .service-row .name{font-weight:700}
  .service-row .meta{color:var(--muted);font-size:14px}
  .price{font-weight:800}
  .book{background:var(--btn);color:var(--btn-ink);border:0;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer}
  .book:hover{background:var(--btn-muted)}
  .all-btn{display:inline-block;margin-top:8px;font-weight:800;padding:10px 14px;border:1px solid var(--border);border-radius:12px;background:#fff;cursor:pointer}
  .all-btn:hover{background:#f4f4f4}

  /* √áalƒ±≈ümalar grid */
  .grid-works{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
  .grid-works img{border-radius:10px;height:160px;object-fit:cover}
  @media (max-width:980px){.grid-works{grid-template-columns:repeat(3,1fr)}}

  /* Sidebar */
  .sidebar{display:flex;flex-direction:column;gap:16px}
  .sticky-book{position:sticky;top:84px;padding:12px}
  .sidebar .card{padding:16px}

  /* Bilgi kartƒ± */
  .info-card .map{height:180px;border-radius:12px;background:linear-gradient(135deg,#ececec,#dcdcdc);margin-bottom:12px}
  .info-card .addr{display:flex;align-items:center;gap:8px;background:#fff;border:1px solid var(--border);border-radius:12px;padding:10px 12px;margin-top:-46px;box-shadow:0 10px 20px rgba(0,0,0,.08);max-width:90%}
  .info-card .addr img{width:28px;height:28px;border-radius:50%;object-fit:cover}
  .info-card h4{margin:12px 0 6px 0}
  .hr{height:1px;background:var(--border);margin:14px 0}
  .callline{display:flex;align-items:center;gap:10px;border:1px solid var(--border);border-radius:12px;padding:10px 12px;margin:10px 0}
  .callline .callbtn{margin-left:auto;background:var(--btn);color:var(--btn-ink);border:0;border-radius:10px;padding:8px 14px;font-weight:700}
  .today{display:flex;align-items:center;justify-content:space-between;padding:8px 0}
  .muted{color:var(--muted)}
  .toggle-link{display:inline-flex;align-items:center;gap:6px;font-weight:600}
  .week{display:none;margin-top:6px}
  .week.show{display:block}
  .week .row{display:flex;align-items:flex-start;justify-content:space-between;padding:8px 0;border-top:1px solid #efefef}
  .note{margin-top:12px;border-left:3px solid #e5e5e5;padding:12px 12px;color:var(--muted);background:#fafafa;border-radius:8px}

  /* ==== Global modallar ==== */
  .modal-ov{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:90}
  .modal-ov.show{display:flex}
  .modal{background:#fff;border-radius:16px;box-shadow:0 30px 60px rgba(0,0,0,.25);max-width:860px;width:92%}
  .modal .hd{display:flex;align-items:center;justify-content:space-between;padding:16px 18px;border-bottom:1px solid var(--border)}
  .modal .hd .ttl{font-weight:800}
  .modal .hd .x{background:#f1f1f1;border:0;border-radius:10px;padding:8px 10px;cursor:pointer}
  .modal .ct{padding:18px;max-height:72vh;overflow:auto}
  .btn-primary{background:var(--btn);color:var(--btn-ink);border:0;border-radius:12px;padding:12px 18px;font-weight:800;cursor:pointer}
  .btn-primary:hover{background:var(--btn-muted)}
  .footerbar{border-top:1px solid var(--border);padding:14px 18px;display:flex;align-items:center;justify-content:space-between}
  .link{color:#111;cursor:pointer;text-decoration:underline}

  .slots{display:grid;grid-template-columns:repeat(auto-fit,minmax(96px,1fr));gap:12px;padding:4px 2px}
  .slot{position:relative;border:1px solid var(--border);border-radius:14px;padding:12px 10px;background:#fff;text-align:center;font-weight:800;letter-spacing:.2px;cursor:pointer;transition:.15s;user-select:none}
  .slot:hover{transform:translateY(-1px);box-shadow:0 10px 18px rgba(0,0,0,.08)}
  .slot:focus-visible{outline:3px solid #cde6ff;outline-offset:2px}
  .slot.active{background:#111;color:#fff;border-color:#111;box-shadow:0 12px 22px rgba(0,0,0,.22)}
  .slot[disabled]{opacity:.45;cursor:not-allowed;background:#fafafa}

  .summary{border:1px solid var(--border);border-radius:12px;padding:12px;margin-top:14px;background:#fafafa}
  .cart-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-top:1px solid #eee}
  .cart-row:first-child{border-top:0}

  .finput{border:1px solid var(--border);border-radius:12px;padding:12px;width:100%;margin:10px 0}
  .svc-item{display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:center;padding:12px 0;border-top:1px solid var(--border)}
  .svc-item .meta{color:var(--muted);font-size:13px}
  .btn-mini{background:var(--btn);color:var(--btn-ink);border:0;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer}
  .btn-mini:hover{background:var(--btn-muted)}

  /* Auth modal */
  .modal-overlay{position:fixed; inset:0; display:none; place-items:center;
    background:rgba(15, 23, 42, .45);backdrop-filter: blur(8px) saturate(1.1);-webkit-backdrop-filter: blur(8px) saturate(1.1);
    padding:20px; z-index:9999;}
  .modal-overlay.active{ display:grid; }
  .auth-box{width:min(520px, 92vw); background:linear-gradient(180deg,#ffffff, #f9fafb); color:#0f172a; border:1px solid rgba(2,6,23,.06);
    border-radius:20px; box-shadow: 0 20px 60px rgba(0,0,0,.25), 0 1px 0 rgba(255,255,255,.4) inset; position:relative; overflow:hidden; animation:pop .2s ease-out;}
  @keyframes pop{ from{ transform:translateY(8px) scale(.985); opacity:0 } to{ transform:none; opacity:1 } }
  .modal-close{position:absolute; top:10px; right:10px; width:36px; height:36px; border-radius:12px; border:1px solid rgba(2,6,23,.08); background:#fff; display:grid; place-items:center; cursor:pointer; color:#0f172a; z-index:2; transition:all .15s ease;}
  .modal-close:hover{ background:#f3f4f6; transform:translateY(-1px); }
  .auth-container{ padding:22px 20px 24px; display:grid; gap:16px; }
  .auth-tabs{ display:flex; gap:8px; justify-content:center; }
  .auth-tab{padding:8px 14px; border-radius:999px; border:1px solid rgba(2,6,23,.08); background:#f8fafc; cursor:pointer; font-weight:700; color:#0f172a; transition:all .15s ease;}
  .auth-tab.active{ background:#111827; color:#fff; border-color:#111827; }
  .auth-form{ display:none; max-width:380px; margin:0 auto; }
  .auth-form.active{ display:block; }
  .auth-input{width:100%; padding:13px 14px; border:1px solid #e5e7eb; border-radius:12px; font-size:15px; background:#fff; transition:border .12s, box-shadow .12s; margin-bottom:10px;}
  .auth-input:focus{ outline:none; border-color:#93c5fd; box-shadow:0 0 0 4px rgba(59,130,246,.15); }
  .auth-btn{width:100%; padding:13px; border:none; border-radius:12px; font-weight:800; background:#0b6ef4; color:#fff; cursor:pointer; letter-spacing:.2px; transition:transform .06s ease, filter .15s ease;}
  .auth-btn:active{ transform:translateY(1px); }
  .auth-btn:disabled{ filter:grayscale(.2) opacity(.7); cursor:not-allowed; }
  .error{ color:#dc2626; font-size:13px; min-height:18px; margin:8px 0 4px; }
  .oauth-stack{ display:grid; gap:10px; max-width:380px; margin:0 auto; }
  .google-btn{display:flex; align-items:center; justify-content:center; gap:10px; width:100%; padding:12px; border-radius:12px; border:1px solid #e5e7eb; background:#fff; color:#0f172a; font-weight:700; cursor:pointer; transition:.15s;}
  .google-btn:hover{ background:#f8fafc; border-color:#d1d5db; }
  .google-btn img{ width:18px; height:18px }

  .divider{ display:flex; align-items:center; gap:10px; color:#6b7280; font-size:12px; margin:6px auto 2px; }
  .divider::before, .divider::after{ content:""; flex:1; height:1px; background:#e5e7eb; }

  .toast{position: fixed; top:18px; left:50%; transform:translateX(-50%) translateY(-16px);
    background:#16a34a; color:#fff; padding:10px 14px; border-radius:999px; font:600 14px/1 'Inter', sans-serif; opacity:0; pointer-events:none;
    transition:transform .25s, opacity .25s, box-shadow .25s; z-index:3000; box-shadow:0 8px 20px rgba(0,0,0,.18);}
  .toast.show{ opacity:1; transform:translateX(-50%) translateY(0); }
</style>
</head>
<body>

<!-- === NAVBAR (birebir) === -->
<header class="topbar" id="mainTopbar">
  <div class="topline container">
    <a class="logo" href="index.html">~arat</a>
    <div class="searchwrap">
      <div class="chip"><i>üîé</i><input placeholder="Hizmet veya i≈ületme ara" /></div>
      <div class="chip"><i>üìç</i><input placeholder="San Diego, CA" /></div>
      <div class="chip"><i>üïë</i><input placeholder="Ne zaman?" /></div>
    </div>
    <div class="top-actions">
      <a class="pillbtn" href="isletmeni-listele.html">ƒ∞≈ületmeni listele</a>
      <a class="pilllink open-auth" href="#">Giri≈ü / Kayƒ±t</a>
      <span class="pilllink">TR</span>
    </div>
  </div>
  <nav class="catbar">
    <div class="container" style="display:flex;gap:22px">
      <a href="kuafor.html">Kuaf√∂r</a>
      <a href="guzellik-salonu.html">G√ºzellik Salonu</a>
    </div>
  </nav>
</header>

<!-- Scroll‚Äôda g√∂r√ºnen kƒ±sa bilgi barƒ± -->
<div id="topInfoBar" class="top-info-bar" aria-hidden="true">
  <div class="ti-inner">
    <div class="ti-left">
      <img class="ti-logo" id="tiLogo" src="img/berber1.jpeg" alt="Logo">
      <div class="ti-meta">
        <div class="ti-title" id="tiTitle">ƒ∞≈ületmeniz</div>
        <div class="ti-sub" id="tiSub">‚Äî</div>
      </div>
    </div>
    <a class="ti-book" href="#" id="stickyBook">Randevu al</a>
  </div>
</div>

<main class="detail-wrap">
  <div>
    <div class="gallery-card card" data-gallery-sentinel>
      <div class="gallery">
        <img id="gal1" data-slide src="img/berber2.jpeg" alt="kuaf√∂r 1">
        <img id="gal2" data-slide src="img/berber3.jpeg" alt="kuaf√∂r 2" style="display:none">
        <img id="gal3" data-slide src="img/berber4.jpeg" alt="kuaf√∂r 3" style="display:none">
        <div class="next" id="nextSlide" title="Sonraki">‚ûú</div>
        <div class="dotbar"><div class="dot active"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
    </div>

    <div class="biz-header">
      <h1 id="bizName">ƒ∞≈ületmeniz</h1>
      <div class="small" id="bizAddrTop">‚Äî</div>
    </div>

    <section class="section card" id="servicesSection">
      <h2>Hizmetler</h2>
      <div id="svcRows">Y√ºkleniyor...</div>
      <button class="all-btn" id="openAllServices">T√ºm hizmetler</button>
    </section>

    <section class="section card">
      <h2>√áalƒ±≈ümalarƒ±mƒ±z</h2>
      <div class="grid-works" id="worksGrid">
        <img src="img/berber5.jpeg" alt=""><img src="img/berber6.jpeg" alt="">
        <img src="img/berber7.jpeg" alt=""><img src="img/berber8.jpeg" alt=""><img src="img/berber9.jpeg" alt="">
      </div>
    </section>
  </div>

  <aside class="sidebar">
    <div class="card sticky-book">
      <button class="book" style="width:100%;padding:12px 16px;border-radius:12px;font-weight:800" id="btnOpenBook">Randevu al</button>
    </div>

    <div class="card info-card" id="infoCard">
      <div class="map"></div>
      <div class="addr">
        <img id="addrLogo" src="img/berber1.jpeg" alt="logo">
        <div>
          <div id="infoName" style="font-weight:700">ƒ∞≈ületmeniz</div>
          <div class="small" id="infoAddr">‚Äî</div>
        </div>
      </div>

      <h4>HAKKIMIZDA</h4>
      <p class="small" id="aboutText">‚Äî</p>
      <div class="hr"></div>

      <h4>ƒ∞LETƒ∞≈ûƒ∞M & √áALI≈ûMA SAATLERƒ∞</h4>
      <div class="callline">
        <span id="phoneText">-</span>
        <a class="callbtn" id="callBtn" href="#">Ara</a>
      </div>

      <div class="today">
        <div><strong>Bug√ºn</strong></div>
        <div class="muted" id="todayTimes">‚Äî</div>
      </div>

      <a href="#" class="toggle-link" id="toggleWeek"><span id="toggleText">T√ºm haftayƒ± g√∂ster</span> ‚ñæ</a>

      <div class="week" id="weekBlock" aria-hidden="true"></div>
      <div class="note" id="hoursNote" style="display:none">√áalƒ±≈üma saatleri hen√ºz eklenmedi.</div>
    </div>
  </aside>
</main>

<!-- ====== RANDEVU MODALI ====== -->
<div class="modal-ov" id="bookOv">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="bookTtl">
    <div class="hd">
      <div class="ttl">
        <span id="bookDateLabel" class="link">‚Äî</span> ‚Ä¢
        <span id="openTime" class="link" style="font-weight:800">Saat se√ß</span>
        <span id="chosenTime" class="small" style="margin-left:8px;color:var(--muted)"></span>
      </div>
      <button class="x" onclick="closeOv('bookOv')">‚úï</button>
    </div>
    <div class="ct">
      <div class="summary" id="cartBox"></div>
      <div class="link" id="openAdd">+ Hizmet ekle</div>
    </div>
    <div class="footerbar">
      <div style="font-weight:800">Toplam: <span id="cartTotal">‚Ç∫0</span></div>
      <button class="btn-primary" id="goReview">Devam et</button>
    </div>
  </div>
</div>

<!-- ====== SAAT MODALI ====== -->
<div class="modal-ov" id="timeOv">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="timeTtl">
    <div class="hd">
      <div class="ttl" id="timeTtl"><span id="timeDateLabel">‚Äî</span> ‚Ä¢ Saat se√ß</div>
      <button class="x" onclick="closeOv('timeOv')">‚úï</button>
    </div>
    <div class="ct">
      <div class="slots" id="timeSlotWrap"></div>
    </div>
    <div class="footerbar">
      <div class="small" style="color:var(--muted)">08:00 ‚Äì 23:00 arasƒ± 15 dk‚Äôlƒ±k aralƒ±klar</div>
      <button class="btn-primary" id="timeDone">Se√ßimi uygula</button>
    </div>
  </div>
</div>

<!-- ====== T√úM Hƒ∞ZMETLER MODALI ====== -->
<div class="modal-ov" id="svcOv">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="svcTtl">
    <div class="hd"><div class="ttl" id="svcTtl">T√ºm hizmetler</div><button class="x" onclick="closeOv('svcOv')">‚úï</button></div>
    <div class="ct">
      <input id="svcSearch" class="finput" placeholder="Hizmet ara" />
      <div id="svcList"></div>
    </div>
  </div>
</div>

<!-- ====== G√ñZDEN GE√áƒ∞R & ONAYLA ====== -->
<div class="modal-ov" id="reviewOv">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="revTtl">
    <div class="hd"><div class="ttl" id="revTtl">G√∂zden ge√ßir ve onayla</div><button class="x" onclick="closeOv('reviewOv')">‚úï</button></div>
    <div class="ct" id="reviewBody"></div>
    <div class="footerbar">
      <div class="muted">√ñdenecek tutar</div>
      <div style="display:flex;align-items:center;gap:14px">
        <div style="font-weight:800" id="reviewTotal">‚Ç∫0</div>
        <button class="btn-primary" id="confirmBook">Onayla ve randevu al</button>
      </div>
    </div>
  </div>
</div>

<!-- ====== Auth Modal ====== -->
<div id="authModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="loginRegisterTitle">
  <div class="auth-box">
    <button class="modal-close" aria-label="Kapat"><i class="fas fa-times" aria-hidden="true"></i></button>
    <div class="auth-container">
      <div class="auth-tabs">
        <button class="auth-tab active" data-tab="login">Giri≈ü Yap</button>
        <button class="auth-tab" data-tab="signup">Kayƒ±t Ol</button>
      </div>
      <div class="oauth-stack">
        <button type="button" class="google-btn" id="googleSignIn">
          <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="" aria-hidden="true"> Google ile devam et
        </button>
        <div class="divider">veya e-posta ile</div>
      </div>
      <form id="loginForm" class="auth-form active" data-form="login">
        <h2>Giri≈ü Yap</h2>
        <input class="auth-input" type="email" name="email" placeholder="E-posta" required />
        <input class="auth-input" type="password" name="password" placeholder="≈ûifre" required />
        <div id="loginError" class="error"></div>
        <button type="submit" class="auth-btn">Giri≈ü Yap</button>
      </form>
      <form id="signupForm" class="auth-form" data-form="signup">
        <h2>Kayƒ±t Ol</h2>
        <input class="auth-input" type="email" name="email" placeholder="E-posta" required />
        <input class="auth-input" type="password" name="password" placeholder="≈ûifre" minlength="6" required />
        <input class="auth-input" type="password" name="confirm" placeholder="≈ûifre Tekrar" required />
        <div id="signupError" class="error"></div>
        <button type="submit" class="auth-btn">Kayƒ±t Ol</button>
      </form>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast" role="status" aria-live="polite"></div>
<div class="toast-wrap" id="toastWrap" aria-live="polite"></div>

<script type="module">
  import { db } from "./js/firebase.js";
  import {
    doc, onSnapshot, collection, query, onSnapshot as watchCol
  } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  const $ = s => document.querySelector(s);
  const escapeHTML = (s="") => String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  const TL = v => '‚Ç∫' + Number(v||0).toLocaleString('tr-TR') + (Number(v)>=1?'+':'');
  const pad = n => n.toString().padStart(2,'0');
  const TR_DAYS = ["Pazar","Pazartesi","Salƒ±","√áar≈üamba","Per≈üembe","Cuma","Cumartesi"];

  /* ---- UI yardƒ±mcƒ±larƒ± (mevcut fonksiyonlarƒ±nƒ±zƒ± kullanƒ±yoruz) ---- */
  function setImages(imgs={}){
    const pick = v => Array.isArray(v) ? v[0] : v;
    const cover = pick(imgs.cover);   // dizi ya da string olabilir
    const salon = pick(imgs.salon);
    const model = pick(imgs.model);
    if(cover) $("#gal1").src = cover;
    if(salon){ $("#gal2").src = salon; $("#gal2").style.display="none"; }
    if(model){ $("#gal3").src = model; $("#gal3").style.display="none"; }
    const logo = salon || cover || "img/berber1.jpeg";
    $("#tiLogo").src = logo; $("#addrLogo").src = logo;
  }

  function renderAddress(loc={}){
    const subTop = [loc.district, loc.province].filter(Boolean).join(" ‚Ä¢ ") || "‚Äî";
    $("#bizAddrTop").textContent = subTop;
    $("#tiSub").textContent = subTop;
    const line1 = [loc.street && (loc.building? `${loc.street} ${loc.building}` : loc.street), loc.neighborhood].filter(Boolean).join(", ");
    const line2 = [loc.district, loc.province].filter(Boolean).join(", ");
    $("#infoAddr").textContent = [line1, line2].filter(Boolean).join(" ‚Ä¢ ") || "‚Äî";
  }

  function renderServices(list=[]){
    const box=$("#svcRows");
    if(!list.length){ box.innerHTML='<div class="muted">Hen√ºz hizmet eklenmemi≈ü.</div>'; return; }
    const first=list.slice(0,3);
    box.innerHTML = first.map(s=>`
      <div class="service-row">
        <div>
          <div class="name">${escapeHTML(s.name||"Hizmet")}</div>
          <div class="meta">${escapeHTML(String(s.min ?? s.duration ?? 30))}dk</div>
        </div>
        <div class="price">${TL(s.price ?? 0)}</div>
        <button class="book open-book"
          data-name="${escapeHTML(s.name||'Hizmet')}"
          data-price="${Number(s.price||0)}"
          data-duration="${Number(s.min ?? s.duration ?? 30)}">Randevu al</button>
      </div>`).join("");

    // ‚ÄúT√ºm hizmetler‚Äù modalƒ± i√ßin
    const container=$("#svcList"), search=$("#svcSearch");
    const paint=(q="")=>{
      const f=list.filter(s=>s.name?.toLowerCase().includes(q.toLowerCase()));
      container.innerHTML=f.map(s=>`
        <div class="svc-item">
          <div><div>${escapeHTML(s.name||"Hizmet")}</div><div class="meta">${escapeHTML(String(s.min ?? s.duration ?? 30))}dk</div></div>
          <div style="font-weight:800">${TL(s.price ?? 0)}</div>
          <button class="btn-mini" data-add="${escapeHTML(s.name||'Hizmet')}">Ekle</button>
        </div>`).join("");
      container.querySelectorAll('[data-add]').forEach(btn=>{
        btn.onclick=()=>{ const nm=btn.getAttribute('data-add');
          const svc=list.find(x=>x.name===nm); window.cart = (window.cart||[]).concat({...svc});
          document.getElementById('svcOv').classList.remove('show'); document.getElementById('bookOv').classList.add('show');
          (window.renderCart||(()=>{}))();
        };
      });
    };
    search?.addEventListener('input', e=>paint(e.target.value));
    paint();

    // ‚ÄúT√ºm hizmetler‚Äù d√ºƒümesi
    $("#openAllServices").onclick=()=>{ paint(''); document.getElementById('svcOv').classList.add('show'); };

    // Sayfadaki ‚ÄúRandevu al‚Äù butonlarƒ±nƒ± sepete baƒüla (mevcut fonksiyonlarƒ±nƒ±zƒ± kullanƒ±r)
    (window.bindOpenBookButtons||(()=>{}))();
  }

  // defaultHours (0..6 -> {open, ranges:[{startMin,endMin}]}) ‚Üí normalize
  const toHM = m => `${pad(Math.floor((m||0)/60))}:${pad((m||0)%60)}`;
  function fromDefaultHours(h={}) {
    const out={};
    for(let i=0;i<7;i++){
      const d = h[i] || h[String(i)] || {};
      if(d.open===false || !Array.isArray(d.ranges) || d.ranges.length===0){ out[i]=[]; continue; }
      out[i] = d.ranges.map(r => `${toHM(r.startMin)} - ${toHM(r.endMin)}`);
    }
    return out;
  }
  function renderHours(hours){
    const weekEl=$("#weekBlock"), todayEl=$("#todayTimes"), note=$("#hoursNote");
    let norm=null;
    // defaultHours yapƒ±sƒ± mƒ±?
    if(hours && (hours[0]?.ranges || hours["0"]?.ranges)) norm = fromDefaultHours(hours);
    // ba≈üka bir custom yapƒ±ysa (eski onb yapƒ±nƒ±z), ‚ÄúKapalƒ±‚Äù g√∂sterelim:
    if(!norm){ note.style.display="block"; todayEl.textContent="‚Äî"; weekEl.innerHTML=""; return; }
    note.style.display="none";
    const t=new Date().getDay(); todayEl.textContent = norm[t]?.length ? norm[t].join(" ‚Ä¢ ") : "Kapalƒ±";
    weekEl.innerHTML="";
    for(let i=0;i<7;i++){
      const row=document.createElement("div"); row.className="row";
      const left=document.createElement("span"); left.textContent=TR_DAYS[i];
      const right=document.createElement("span"); right.className="muted";
      right.textContent = norm[i]?.length ? norm[i].join("  ‚Ä¢  ") : "Kapalƒ±";
      if(i===t){ left.style.fontWeight="800"; right.style.fontWeight="800"; right.style.color="#111"; }
      row.append(left,right); weekEl.appendChild(row);
    }
  }

  /* ------- GER√áEK VERƒ∞: businesses/<ownerId> ------- */
  const params = new URLSearchParams(location.search);
  // URL'de ?uid=ownerId (√∂r: profile.html?uid=63DMIR... ) bekliyoruz
  const OWNER_ID = params.get("uid") || localStorage.getItem("arat_owner_id") || "";

  async function loadBusinessRealtime(ownerId){
    if(!ownerId){ console.warn("ownerId yok"); return; }

    // ƒ∞≈ületme dok√ºmanƒ±
    const ref = doc(db, "businesses", ownerId);
    onSnapshot(ref, (snap)=>{
      if(!snap.exists()){ console.warn("ƒ∞≈ületme bulunamadƒ±"); return; }
      const d = snap.data()||{};

      // ƒ∞sim / ba≈ülƒ±k
      const name = d.business?.name || d.name || "ƒ∞≈ületmeniz";
      $("#bizName").textContent = name; $("#tiTitle").textContent = name; $("#infoName").textContent = name; document.title = `${name} ‚Äì Arat`;

      // Hakkƒ±mƒ±zda
      $("#aboutText").textContent = (d.business?.about || d.about || "‚Äî").trim() || "‚Äî";

      // Telefon
      const phoneRaw = d.owner?.phoneE164 || d.phoneE164 || d.owner?.phone || d.phone || "";
      const fmtPhoneTR = (p="") => { const n=(p||"").replace(/\D/g,""); const nat=n.startsWith("90")?n.slice(2):n.slice(-10); return nat.length===10?`(${nat.slice(0,3)}) ${nat.slice(3,6)}-${nat.slice(6,8)}-${nat.slice(8)}`:"-"; };
      $("#phoneText").textContent = phoneRaw ? fmtPhoneTR(phoneRaw) : "-";
      $("#callBtn").setAttribute("href", phoneRaw ? `tel:${phoneRaw}` : "#");

      // Adres
      const loc = d.businessLocation || d.business?.location || {};
      renderAddress({
        province: loc.province, district: loc.district,
        neighborhood: loc.neighborhood, street: loc.street, building: loc.building
      });

      // G√∂rseller
      setImages(d.images||{});

      // Hizmetler (top-level services tercih)
      const services = Array.isArray(d.services) ? d.services
                     : Array.isArray(d.catalog?.services) ? d.catalog.services
                     : [];
      renderServices(services);

      // √áalƒ±≈üma saatleri (defaultHours)
      renderHours(d.defaultHours || d.business?.hours || null);

      // √áalƒ±≈ümalar grid‚Äôi: resimler varsa g√ºncelle
      const pics=[].concat(d.images?.cover||[], d.images?.salon||[], d.images?.model||[])
                   .filter(Boolean).slice(0,5);
      if(pics.length){ $("#worksGrid").innerHTML=pics.map(u=>`<img src="${u}" alt="">`).join(""); }
    });

    // (Opsiyonel) Personel anlƒ±k dinleme √∂rneƒüi
    const staffQ = query(collection(db,"businesses", ownerId, "staff"));
    watchCol(staffQ, (qs)=>{
      const staff = qs.docs.map(x=>({id:x.id, ...x.data()}));
      // ƒ∞stediƒüiniz yerde staff bilgisini kullanabilirsiniz:
      window._aratStaff = staff;
      // √ñrn: console.log("staff", staff);
    });
  }

  loadBusinessRealtime(OWNER_ID);
</script>


<!-- Firebase auth akƒ±≈üƒ± + UI g√ºncelle -->
<script type="module" src="js/auth.js"></script>
</body>
</html>
