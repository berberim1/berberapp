<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Yönetici Kaydı – Mobil Hizmet</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer"/>

  <style>
    :root{
      --bg:#efefef; --card:#ffffff; --text:#111827; --muted:#6b7280;
      --border:#e5e7eb; --primary:#191919; --accent:#22c55e; --current:#2563eb;
      --radius:14px; --shadow:0 8px 30px rgba(0,0,0,0.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--text); display:flex; flex-direction:column; align-items:center;
      padding:28px 18px 32px;
    }
    /* Stepper */
    .stepper{ width:min(960px,100%); margin:4px auto 18px; display:flex; gap:10px; padding:0 4px; align-items:center; }
    .step{ display:flex; align-items:center; gap:10px; flex:1 1 auto; }
    .dot{ width:34px; height:34px; border-radius:999px; display:grid; place-items:center; font-weight:800; border:2px solid var(--border); background:#fff; color:var(--muted); }
    .step.done .dot{ border-color:var(--accent); color:#fff; background:var(--accent); }
    .step.current .dot{ border-color:var(--current); color:var(--current); background:#fff; }
    .bar{ height:6px; border-radius:999px; flex:1; background:#e9ecef; }
    .bar.done{ background:var(--accent); }
    /* Card */
    .card{ width:min(560px,100%); background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px 26px 26px; }
    .top{ display:flex; align-items:center; gap:14px; margin-bottom:6px; }
    .back-btn{ width:40px; height:40px; border-radius:10px; border:1px solid var(--border); display:flex; align-items:center; justify-content:center; background:#fff; cursor:pointer; }
    h1{ font-size:26px; font-weight:800; margin:10px 0 6px; text-align:center; }
    .subtitle{ text-align:center; color:var(--muted); margin-bottom:18px; }
    /* Choices */
    .choices{ display:grid; gap:12px; margin:14px 0 18px; }
    .choice{ display:flex; gap:12px; align-items:flex-start; border:1px solid var(--border); border-radius:12px; padding:14px; cursor:pointer; background:#fff; transition:.2s; }
    .choice:hover{ border-color:var(--current); }
    .choice input{ accent-color:var(--primary); margin-top:3px; }
    .choice strong{ display:block; margin-bottom:2px; }
    .choice span{ font-size:13px; color:var(--muted); }
    .btn{ width:100%; height:46px; border-radius:10px; border:none; background:var(--primary); color:#fff; font-weight:800; cursor:pointer; }
    .btn[disabled]{ opacity:.6; cursor:not-allowed; }
    /* toast */
    .toast{ position:fixed; left:50%; bottom:22px; transform:translateX(-50%); background:#111827; color:#fff; padding:10px 14px; border-radius:10px; font-size:14px; display:none; z-index:1000 }
    .toast.show{ display:block; animation:fade 2.2s ease both }
    .toast.err{ background:#dc2626; }
    @keyframes fade{ 0%{opacity:0;transform:translate(-50%,8px)} 10%{opacity:1;transform:translate(-50%,0)} 90%{opacity:1} 100%{opacity:0;transform:translate(-50%,8px)} }
  </style>
</head>
<body>
  <!-- Stepper: 1 ve 2 tamam, 3 aktif -->
  <nav class="stepper" aria-label="Kayıt adımları">
    <div class="step done"><div class="dot"><i class="fa-solid fa-check"></i></div><div class="bar done"></div></div>
    <div class="step done"><div class="dot"><i class="fa-solid fa-check"></i></div><div class="bar done"></div></div>
    <div class="step current"><div class="dot">3</div><div class="bar"></div></div>
    <div class="step"><div class="dot">4</div><div class="bar"></div></div>
    <div class="step"><div class="dot">5</div><div class="bar"></div></div>
    <div class="step"><div class="dot">6</div><div class="bar"></div></div>
    <div class="step"><div class="dot">7</div><div class="bar"></div></div>
    <div class="step"><div class="dot">8</div><div class="bar"></div></div>
    <div class="step"><div class="dot">9</div></div>
  </nav>

  <main class="card" role="main">
    <div class="top">
      <button class="back-btn" id="btnBack" aria-label="Geri"><i class="fa-solid fa-arrow-left"></i></button>
    </div>

    <h1>Mobil hizmetiniz var mı?</h1>
    <p class="subtitle">
      <b>Mobil hizmet</b>, müşterilerin bulunduğu adrese gidip hizmet vermenizdir (ev, ofis vb.).
      Sadece iş yerinizde hizmet veriyorsanız “Hayır” seçin.
    </p>

    <form id="mobileForm" autocomplete="off">
      <div class="choices">
        <label class="choice">
          <input type="radio" name="mobile" value="yes" />
          <div>
            <strong>Evet, mobil hizmet veriyorum</strong>
            <span>Müşterinin konumuna gidip hizmet verebilirim.</span>
          </div>
        </label>
        <label class="choice">
          <input type="radio" name="mobile" value="no" />
          <div>
            <strong>Hayır, yalnızca iş yerimde hizmet veriyorum</strong>
            <span>Müşteriler randevu saatinde salonuma gelir.</span>
          </div>
        </label>
      </div>
      <button id="continueBtn" class="btn" type="submit" disabled>DEVAM ET</button>
    </form>
  </main>

  <div id="toast" class="toast"></div>

  <script type="module">
    const $=(s,r=document)=>r.querySelector(s);

    // ---- Akış doğrulama (opsiyonel, 1-2 adımın tamamlanmış olduğundan emin olmak için) ----
    const K_EMAIL  = "pending_admin_email";
    const K_FLOW   = "admin_onboarding_flow";
    const email = (localStorage.getItem(K_EMAIL)||"").trim().toLowerCase();
    const flow  = (localStorage.getItem(K_FLOW)||"").trim().toLowerCase();
    if(!email || flow!=="admin"){
      alert("Geçersiz akış. Lütfen yönetici kaydına baştan başlayın.");
      location.replace("admin-register-login.html");
    }

    // ---- Anahtarlar ----
    const K_STEP3 = "step3";                        // { hasMobileService: boolean }
    const K_LAST  = "admin_onboarding_last_step";   // "3"

    // ---- Toast helper ----
    const toast=$("#toast");
    const showToast=(t)=>{ 
      toast.textContent=t; 
      toast.className="toast show err"; 
      setTimeout(()=>toast.classList.remove("show","err"),2200); 
    };

    // ---- Çıkış uyarısı (sayfadan farklı yere giderse) ----
    let allowLeave=false;
    window.addEventListener("beforeunload",e=>{ if(!allowLeave){ e.preventDefault(); e.returnValue=""; }});

    // ---- Geri: doğrudan admin-register2.html'e dön, veriler korunur ----
    $("#btnBack").addEventListener("click",e=>{
      e.preventDefault();
      allowLeave=true;
      location.replace("admin-register2.html");
    });

    // ---- Form & buton ----
    const form = $("#mobileForm");
    const btn  = $("#continueBtn");

    // ---- Varsa önceki seçimleri yükle ve alanı doldur ----
    try{
      const prev = JSON.parse(localStorage.getItem(K_STEP3) || "null");
      if(prev && typeof prev.hasMobileService === "boolean"){
        const val = prev.hasMobileService ? "yes" : "no";
        const radio = form.querySelector(`input[name="mobile"][value="${val}"]`);
        if(radio){ radio.checked = true; btn.disabled = false; }
      }
    }catch{/* yok say */}

    // Label tıklanınca radio seçilsin
    document.querySelectorAll(".choice").forEach(label=>{
      label.addEventListener("click",()=>{
        const radio=label.querySelector('input[type="radio"]');
        if(radio){ radio.checked=true; btn.disabled=false; }
      });
    });

    // Radio değişince buton aktifle
    form.addEventListener("change",()=>{ btn.disabled=!form.mobile?.value; });

    // ---- Kaydet ve yönlendir ----
    form.addEventListener("submit",e=>{
      e.preventDefault();
      const picked=form.mobile?.value;
      if(!picked){ showToast("Lütfen bir seçenek seçin."); return; }

      const hasMobile = (picked === "yes");
      // JSON: { hasMobileService: true/false }
      localStorage.setItem(K_STEP3, JSON.stringify({ hasMobileService: hasMobile }));
      localStorage.setItem(K_LAST, "3");

      allowLeave=true;
      // İstersen farklı akışlara göre branşla:
      location.replace(hasMobile ? "admin-register4.html" : "admin-register5.html");
    });
  </script>
</body>
</html>
